<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ordersMapper">

	<resultMap id="ordersResult" type="Orders">
		<id property="orders_seq_id" column="orders_seq_id" />
		<result property="cart_seq_id" column="cart_seq_id" />
		<result property="product_seq_id" column="product_seq_id" />
		<result property="user_email" column="user_email" />
		<result property="amount" column="amount" />
		<result property="totalPrice" column="totalprice" />
		<result property="order_success" column="orders_success" />
		<result property="purchase_date" column="orders_at" />
		<association property="product" javaType="Product">
			<result property="product_name" column="product_name" />
			<result property="product_price" column="product_price" />
			<result property="rename_filepath" column="rename_filepath" />
		</association>
	</resultMap>



	<select id="selectOrder" parameterType="string">
		SELECT product_name 상품이름 , client_name 판매자상호명 ,  price 가격 count 주문 수량 , amount 총 가격
		FROM orders join product using (product_seq_id)
		product join client using (business_number);
		WHERE user_email = #{ user_email }
	</select>

	<select id="selectOrdersWithProductInfoByCartList" parameterType="list" resultMap="ordersResult">
		SELECT o.*, p.product_name, p.product_price, p.rename_filepath
		FROM orders o
		INNER JOIN products p ON o.product_seq_id = p.product_seq_id
		WHERE o.cart_seq_id IN
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
			#{item.cart_seq_id}
		</foreach>
	</select>


	<insert id="createOrder" parameterType="map">
		INSERT INTO orders  (orders_seq_id, cart_seq_id, product_seq_id, user_email, amount, price, orders_success, orders_at)
		VALUES (orders_seq_id.NEXTVAL, #{cart_seq_id}, #{product_seq_id}, #{user_email}, #{amount}, #{price}, 'Y', SYSDATE)
	</insert>

</mapper>